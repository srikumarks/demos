<!DOCTYPE html>
<html>
    <head>
        <script src="../lib/codemirror3/lib/codemirror.js"></script>
        <link rel="stylesheet" href="../lib/codemirror3/lib/codemirror.css">
        <script src="../lib/codemirror3/mode/javascript/javascript.js"></script>
        <script src="steller.js"></script>
        <script src="steller_explorer.js" defer></script>
        <style type="text/css">
            img, canvas {
                border: solid;
                border-width: 1px;
                margin: 5px;
                padding: 5px;
                border-color: #cfcfcf;
            }
        </style>
        <!-- google analytics -->
        <script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-37337144-1']);
            _gaq.push(['_trackPageview']);

            (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();

         </script>
    </head>
    <body>
        <table>
            <tr>
                <td width="30%" valign="top">
                    <div>
                        <canvas id="canvas" width="256" height="256"/>
                    </div>
                    <div>
                        <button id="export">Save image</button>
                        <button id="cancel">Stop playing!</button>
                        <div><small>
                                <ul>
                                    <li>Saved images appear below.</li>
                                    <li>Click image to load its code.</li>
                                    <li>Shift-click to delete a saved image.</li>
                                </ul>
                            </small></div>
                    </div>
                    <hr/>
                    <div id="rendered"></div>
                </td>
                <td width="50%" valign="top">
<textarea id="code" placeholder="Canvas drawing code" cols="80" rows="50">
</textarea>
<br/>
<div id="example_buttons">
    Examples: 
</div>
<div id="example_code" hidden>
    <pre data-name="Blank"></pre>
    <pre data-name="Instructions">
// Code goes here. To evaluate a line, position cursor on it
// and press "Alt-Enter". To evaluate a selection, select code
// and press "Alt-Enter".
//
// Methods of the canvas 2d context can simply be called 
// without the "context." object prefix.
// 
// Math functions can be used without the "Math." prefix.
//
// For CSS colors, the function rgba(r,g,b,a) is available
// and better suited for use with Animations.
//
// A steller Scheduler instance is now running and its methods
// such as play(), track(), etc. are also available without an
// object prefix.
//
// All the models in the 'models' property of the steller Scheduler
// are also available unprefixed.

// Some basic setup code.
R = 128;
C = R/2;
canvas.width = R;
canvas.height = R;
canvas.style.backgroundColor = 'black';

// Make a parameter that we'll animate.
pos = Param({min: C - 30, max: C + 30, value: C});

// The draw function will draw a box at the position given
// by `pos`.
draw = function (clock) {
    clearRect(0, 0, R, R);
    fillStyle = 'blue';
    fillRect(pos.valueOf(), C, 20, 20);
};

// Start the draw loop.
play(loop(frame(draw)));

// Make a chime model instance and connect it to the audio destination.
ch = chime().connect();

// Convenience function to play a note using the chime model.
note = function (p, d) {
    return track([ch.play(p, 1.0), delay(d)]);
};

// Play a looping pattern and insert a sync object at the
// start of the loop so that we can sync events to that.
s = sync();
play(loop(track([s, note(72,0.5), note(79,0.5), note(84,0.5)])));

// Run the line below to play a note exactly at the start of the above loop.
s.play(note(96,0.5));

// Run the line below to start animating the rectangle's position
// exactly at the start of the above note loop.
s.play(loop(anim(pos, 1.5, C-30, C+30)));
    </pre>
    <pre data-name="Temporal recursion">
// Reminder: Alt-Enter on a line will evaluate that line. If some
// is selected, then that will be evaluated.
//
// Select all of the text below and hit Alt-Enter to run this example.
//
// After evaluating code, positioning cursor within a name assigned
// to a Param will pop up a slider to change its value.

// Note: Demonstrating simple temporal recursion to produce a sequence
// of random notes. No visuals, only sound.

ch = chime().connect(); // Chime model connected to destination.

// Convenience function to play a note using the chime model.
note = function (p, d) {
    return track([ch.play(p, 1.0), delay(d)]);
};


speed = Param({min:0.1, max:5.0, value:1.5, mapping:'log'});
pitch = Param({min:60, max:96, value:72});

durations = [0.25, 0.5, 0.25, 0.25, 0.25, 0.25, 0.5, 0.5, 1.0];
random_duration = function () {
  return durations[floor(random() * durations.length)] / speed.value;
};

penta = [0, 2, 4, 7, 9, 12, 14, 16, 19, 21, 24];
penta1 = [0, 2, 4, 7, 9, 12];
major = [0, 2, 4, 5, 7, 9, 11, 12, 14, 16, 17, 19, 21, 23, 24];
minor = [0, 2, 3, 5, 7, 9, 10, 12, 14, 15, 17, 19, 21, 22, 24];
maya = [0, 1, 4, 5, 7, 8, 11, 12];
scale = major;

random_note = dynamic(function (clock) {
    return track([note(pitch.value + scale[floor(scale.length * random())], random_duration()), random_note]);
});

play(random_note);
    </pre>
    <pre data-name="Polyphonic visuals">
// Reminder: Alt-Enter on a line will evaluate that line. If some text
// is selected, then that will be evaluated.
//
// Select all of the text below and hit Alt-Enter to run this example.
//
// After evaluating code, positioning cursor within a name assigned
// to a Param will pop up a slider to change its value.

ch = chime().connect(); // Chime model connected to destination.

// Convenience function to play a note using the chime model.
note = function (p, d) {
    return track([ch.play(p, 1.0), delay(d)]);
};

// Choose one from an array at random
choose = function (arr) {
  return arr[floor(arr.length * random())];
};

speed = Param({min:0.1, max:5.0, value:1.5, mapping:'log'});
pitch = Param({min:60, max:96, value:72});

durations = [0.25, 0.5, 0.25, 0.25, 0.25, 0.25, 0.5, 0.5, 1.0];

canvas.width = 400;
canvas.height = 128;
canvas.style.backgroundColor = 'black';

// The draw function will draw a box at the position
// determined by n (note number) and d (duration).
draw = function (n, d) {
  return function (clock, t1r, t2r, start) {
    fillStyle = rgba(255,255,255,exp(-2*(t1r - start)/d));
    fillRect(16 + 12 * n, 32, 12, 64);
  };
};

// Clear the frame as the first step in every draw cycle.
play(loop(frame(function (clock) { clearRect(0, 0, canvas.width, canvas.height); })));

noteWithVisual = dynamic(function (clock) {
  var n = choose(scale);
  var d = choose(durations);
  var ds = d / speed.value; // Speed-adjusted decay duration.
  return track([spawn(frames(5*ds, draw(n, 2*ds))), note(pitch.value + n, d)]);
});

penta = [0, 2, 4, 7, 9, 12, 14, 16, 19, 21, 24];
penta1 = [0, 2, 4, 7, 9, 12];
major = [0, 2, 4, 5, 7, 9, 11, 12, 14, 16, 17, 19, 21, 23, 24];
minor = [0, 2, 3, 5, 7, 9, 10, 12, 14, 15, 17, 19, 21, 22, 24];
maya = [0, 1, 4, 5, 7, 8, 11, 12];
scale = maya;

// Directly control the clock's rate using the speed parameter.
// Notice that there is very little delay in response when you
// change the speed, even if a long note has been just scheduled.
// Position the text cursor within the "speed" variable name 
// to control it.
play(track([rate(speed), loop(noteWithVisual)]));
            </pre>
</div>
                </td>
            </tr>
            <tr><td>
            </td></tr>
        </table>
    </body>
</html>
